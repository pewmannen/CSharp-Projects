using System;
using System.Collections.Generic;
using System.Globalization;
using System.Reflection.Metadata.Ecma335;

//Problem Summary
//You are given a list of strings representing sales records in the format:
//< region >,< productCode >,< amount >
//Return a dictionary mapping each region to the total sales amount.

//Requirements
//If the list is null, return an empty dictionary
//Ignore null or whitespace lines
//Ignore lines that do not have exactly 3 comma-separated parts
//Trim whitespace around each part
//Ignore lines where:
//region is null or empty after trimming
//productCode is null or empty after trimming
//amount cannot be parsed as decimal
//amount is less than or equal to 0
//Region matching is case-insensitive
//Output dictionary keys must be UPPERCASE
//Total is the sum of all valid amounts per region
//Do not throw exceptions

public static class SalesStats
{
    public static Dictionary<string, decimal> TotalSalesByRegion(List<string> lines)
    {
        var result = new Dictionary<string, decimal>();

        if (lines == null)
        {
            return result;
        }

        foreach (var line in lines)
        {
            if (line == null)
            {
                continue; 
            }

            if (string.IsNullOrWhiteSpace(line))
            {
                continue;
            }

            var parts = line.Split(',');

            if (parts.Length != 3)
            {
                continue;
            }

            var region = parts[0].Trim();
            var productCode = parts[1].Trim();
            var amountText = parts[2].Trim();

            if (string.IsNullOrWhiteSpace(region))
            {
                continue;
            }

            if (string.IsNullOrWhiteSpace(productCode))
            {
                continue;
            }

            // If parsing decimals from strings that use . ("19.95") -> use NumberStyles.Number, CultureInfo.InvariantCulture
            // decimal.TryParse(string) uses the current OS culture by default. The result for SWE keyboard would return false since it expects ("19,95") NOT ("19.95")
            if (!decimal.TryParse(amountText, NumberStyles.Number, CultureInfo.InvariantCulture, out var amount))
            {
                continue;
            }

            if (amount <= 0)
            {
                continue;
            }

            var key = region.ToUpperInvariant();

            if (result.ContainsKey(key))
            {
                result[key] += amount;
            }
            else
            {
                result[key] = amount;
            }

        }

        return result;
    }
}

public class Program
{
    public static void Main()
    {
        var lines = new List<string>
        {
            "EU,PRD1,19.95",
            "eu,PRD2,10.05",
            "US,PRD3,50",
            "US,PRD4,0",           // ignore
            "BadLine",             // ignore
            "APAC,,25",             // ignore (missing productCode)
            " ,X1,5",               // ignore (missing region)
            null,
            "  EU , P9 , 5.00  "
        };

        var result = SalesStats.TotalSalesByRegion(lines);

        foreach (var kvp in result)
            Console.WriteLine($"{kvp.Key} => {kvp.Value}");

        // Expected output:
        // EU => 35
        // US => 50
    }
}